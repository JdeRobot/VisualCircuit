{"editor":{"id":"102dcb41-878e-49fa-991b-b72f74b38cad","locked":false,"offsetX":3,"offsetY":-2,"zoom":100,"gridSize":0,"layers":[{"id":"8d100ba9-6747-4345-be87-9f7f4fb8f753","type":"diagram-links","isSvg":true,"transformed":true,"models":{"fe8087ec-cdcd-4957-98f7-d40632907fac":{"id":"fe8087ec-cdcd-4957-98f7-d40632907fac","type":"default","selected":false,"source":"0004-a6e56f95-1dc2-4c97-835a-f4d7c0980e50","sourcePort":"54a31c83-d088-444d-8daa-e297806504e4","target":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","targetPort":"253fc57c-e90e-489b-a4ee-610a80c56915","points":[{"id":"3941b657-0aac-4245-b2e1-e8727eceb1a0","type":"point","x":882,"y":128.5},{"id":"665cf0d5-ed02-4394-ad87-45633a81da12","type":"point","x":903.3125,"y":259.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"b55e85cc-82d2-4e4c-84b2-c8f17affc430":{"id":"b55e85cc-82d2-4e4c-84b2-c8f17affc430","type":"default","selected":false,"source":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","sourcePort":"509994c2-03c9-4d40-87d4-e4a725ce1f74","target":"886b6861-1deb-47bb-a4ae-1e452d3ad787","targetPort":"36b882fa-7cb9-449b-ac0b-ceafd50b5321","points":[{"id":"fdb1a58f-47a4-400c-b2ec-d4924dc749b8","type":"point","x":1372.140625,"y":551},{"id":"7f123b27-4668-4c24-91bb-d03c6b2ba4de","type":"point","x":1420.5,"y":540.5}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"},"97e7a72d-6aaa-40b7-a330-cae873eb57a5":{"id":"97e7a72d-6aaa-40b7-a330-cae873eb57a5","type":"default","selected":false,"source":"759a92b9-a22a-49df-8fe1-3ca09741e5ed","sourcePort":"fba03ed4-1910-48cd-9b0e-ef390442a85b","target":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","targetPort":"efe71d1e-1ef1-4734-b8e5-d54235c63a36","points":[{"id":"ffdcb3b7-819b-4cb3-a125-58f29fa457bb","type":"point","x":337.5,"y":538.5},{"id":"864723fa-8864-4fac-b3ee-7a742a2be96b","type":"point","x":434.5,"y":551}],"labels":[],"width":3,"color":"gray","curvyness":50,"selectedColor":"rgb(0,192,255)"}}},{"id":"c58fd49b-840b-4f86-afbb-1970f624f06f","type":"diagram-nodes","isSvg":false,"transformed":true,"models":{"759a92b9-a22a-49df-8fe1-3ca09741e5ed":{"id":"759a92b9-a22a-49df-8fe1-3ca09741e5ed","type":"basic.input","selected":false,"x":244,"y":512,"ports":[{"id":"fba03ed4-1910-48cd-9b0e-ef390442a85b","type":"port.output","x":330,"y":531,"name":"input-out","alignment":"right","parentNode":"759a92b9-a22a-49df-8fe1-3ca09741e5ed","links":["97e7a72d-6aaa-40b7-a330-cae873eb57a5"],"in":false,"label":"Enable","hideLabel":true}],"data":{"name":"Enable"}},"886b6861-1deb-47bb-a4ae-1e452d3ad787":{"id":"886b6861-1deb-47bb-a4ae-1e452d3ad787","type":"basic.output","selected":false,"x":1412,"y":514,"ports":[{"id":"36b882fa-7cb9-449b-ac0b-ceafd50b5321","type":"port.input","x":1413,"y":533,"name":"output-in","alignment":"left","parentNode":"886b6861-1deb-47bb-a4ae-1e452d3ad787","links":["b55e85cc-82d2-4e4c-84b2-c8f17affc430"],"in":true,"label":"output-in","hideLabel":true}],"data":{"name":"Out"}},"0004-a6e56f95-1dc2-4c97-835a-f4d7c0980e50":{"id":"0004-a6e56f95-1dc2-4c97-835a-f4d7c0980e50","type":"basic.constant","selected":false,"x":821,"y":13,"ports":[{"id":"54a31c83-d088-444d-8daa-e297806504e4","type":"port.output","x":874.5,"y":121,"name":"constant-out","alignment":"bottom","parentNode":"0004-a6e56f95-1dc2-4c97-835a-f4d7c0980e50","links":["fe8087ec-cdcd-4957-98f7-d40632907fac"],"in":false,"label":"ROSTopic","hideLabel":true}],"data":{"name":"ROSTopic","value":"/depth_camera/image_raw","local":true}},"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd":{"id":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","type":"basic.code","selected":true,"x":425,"y":181,"ports":[{"id":"efe71d1e-1ef1-4734-b8e5-d54235c63a36","type":"port.input","x":427,"y":543.5,"name":"Enable","alignment":"left","parentNode":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","links":["97e7a72d-6aaa-40b7-a330-cae873eb57a5"],"in":true,"label":"Enable","hideLabel":false},{"id":"509994c2-03c9-4d40-87d4-e4a725ce1f74","type":"port.output","x":1364.640625,"y":543.5,"name":"Out","alignment":"right","parentNode":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","links":["b55e85cc-82d2-4e4c-84b2-c8f17affc430"],"in":false,"label":"Out","hideLabel":false},{"id":"253fc57c-e90e-489b-a4ee-610a80c56915","type":"port.parameter","x":895.8125,"y":252,"name":"ROSTopic","alignment":"top","parentNode":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","links":["fe8087ec-cdcd-4957-98f7-d40632907fac"],"in":true,"label":"ROSTopic","hideLabel":false}],"data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom sensor_msgs.msg import Image\n\nbridge = CvBridge()\nframe = None\n\n# ros2 node class\nclass CamSubscriber(Node):\n \n    def __init__(self, topic):\n\n        super().__init__('cam_subscriber')\n        self.subscription = self.create_subscription(\n            Image, topic, self.callback, 10)\n\n        self.subscription  # prevent unused variable warning\n\n\n    def callback(self, msg):\n\n        global frame\n        frame = np.asarray(bridge.imgmsg_to_cv2(msg, \"bgr8\"), dtype=np.uint8)\n\n\n\ndef main(inputs, outputs, parameters, synchronise):\n    global frame\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    camera_subscriber = CamSubscriber(parameters.read_string(\"ROSTopic\"))\n\n    try:\n        while auto_enable or inputs.read_number('Enable'):\n            frame =  None\n            rclpy.spin_once(camera_subscriber)\n\n            if frame is not None:\n                outputs.share_image(\"Out\", frame)\n\n            synchronise()\n    except Exception as e:\n        print('Error:', e)\n        pass\n    finally:\n        print(\"Exiting\")\n        synchronise()     \n        camera_subscriber.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROSTopic"}],"ports":{"in":[{"name":"Enable"}],"out":[{"name":"Out"}]},"size":{"width":"300px","height":"300px"}}}}}]},"version":"3.0","package":{"name":"ROS2Camera","version":"2.0.0","description":"Captures Video Stream from Simulated ROS2 Camera","author":"David Tapiador de Vera","image":"data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQ3MnB0IiB2aWV3Qm94PSIwIC04NyA0NzIgNDcyIiB3aWR0aD0iNDcycHQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQ2MiAzNS4xMjEwOTR2MjI3LjgyMDMxMmwtMTIxLjg3ODkwNi02Ni41NTA3ODFoLTEuMjEwOTM4di05NC43MTg3NWgxLjIxMDkzOHptMCAwIiBmaWxsPSIjMDBhY2VhIi8+PHBhdGggZD0ibTMzOC45MTAxNTYgMTk2LjM5MDYyNXY1MS4wMzEyNWMwIDIyLjA4OTg0NC0xNy45MTAxNTYgNDAtNDAgNDBoLTI0OC45MTAxNTZjLTIyLjA4OTg0NCAwLTQwLTE3LjkxMDE1Ni00MC00MHYtMTk3LjQyMTg3NWMwLTIyLjA4OTg0NCAxNy45MTAxNTYtNDAgNDAtNDBoMjQ4LjkxMDE1NmMyMi4wODk4NDQgMCA0MCAxNy45MTAxNTYgNDAgNDB6bTAgMCIgZmlsbD0iIzAwZWZkMSIvPjxwYXRoIGQ9Im00NjcuMTAxNTYyIDI2LjUxOTUzMWMtMy4wMzkwNjItMS44MDA3ODEtNi43OTY4NzQtMS44NjcxODctOS44OTg0MzctLjE3NTc4MWwtMTA4LjI5Njg3NSA1OS4xMzI4MTJ2LTM1LjQ3NjU2MmMtLjAzMTI1LTI3LjYwMTU2Mi0yMi4zOTg0MzgtNDkuOTY4NzUtNTAtNTBoLTI0OC45MDYyNWMtMjcuNjAxNTYyLjAzMTI1LTQ5Ljk2ODc1IDIyLjM5ODQzOC01MCA1MHYxOTcuNDIxODc1Yy4wMzEyNSAyNy41OTc2NTYgMjIuMzk4NDM4IDQ5Ljk2NDg0NCA1MCA1MGgyNDguOTEwMTU2YzI3LjYwMTU2My0uMDM1MTU2IDQ5Ljk2ODc1LTIyLjQwMjM0NCA1MC01MHYtMzQuODM5ODQ0bDEwOC4zMDA3ODIgNTkuMTMyODEzYzMuMDk3NjU2IDEuNjkxNDA2IDYuODU1NDY4IDEuNjI1IDkuODkwNjI0LS4xNzU3ODIgMy4wMzUxNTctMS44MDQ2ODcgNC44OTg0MzgtNS4wNzAzMTIgNC44OTg0MzgtOC42MDE1NjJ2LTIyNy44MTY0MDZjMC0zLjUzMTI1LTEuODYzMjgxLTYuODAwNzgyLTQuODk4NDM4LTguNjAxNTYzem0tMTM4LjE5MTQwNiAyMjAuOTAyMzQ0Yy0uMDE5NTMxIDE2LjU1ODU5NC0xMy40Mzc1IDI5Ljk4MDQ2OS0zMCAzMGgtMjQ4LjkxMDE1NmMtMTYuNTYyNS0uMDE5NTMxLTI5Ljk4MDQ2OS0xMy40NDE0MDYtMzAtMzB2LTE5Ny40MjE4NzVjLjAxOTUzMS0xNi41NjI1IDEzLjQzNzUtMjkuOTgwNDY5IDMwLTMwaDI0OC45MTAxNTZjMTYuNTYyNS4wMTk1MzEgMjkuOTgwNDY5IDEzLjQzNzUgMzAgMzB6bTEyMy4wODk4NDQtMS4zMzU5MzctMTAzLjA4OTg0NC01Ni4yODkwNjN2LTgxLjUzMTI1bDEwMy4wODk4NDQtNTYuMjkyOTY5em0wIDAiIGZpbGw9IiMwODM4NjMiLz48L3N2Zz4="},"design":{"board":"Python3-Noetic","graph":{"blocks":[{"id":"759a92b9-a22a-49df-8fe1-3ca09741e5ed","type":"basic.input","data":{"name":"Enable"},"position":{"x":244,"y":512}},{"id":"886b6861-1deb-47bb-a4ae-1e452d3ad787","type":"basic.output","data":{"name":"Out"},"position":{"x":1412,"y":514}},{"id":"0004-a6e56f95-1dc2-4c97-835a-f4d7c0980e50","type":"basic.constant","data":{"name":"ROSTopic","value":"/depth_camera/image_raw","local":true},"position":{"x":821,"y":13}},{"id":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","type":"basic.code","data":{"code":"#!/usr/bin/env python3\n\nimport numpy as np\nimport rclpy\nfrom rclpy.node import Node\nfrom cv_bridge import CvBridge\nfrom sensor_msgs.msg import Image\n\nbridge = CvBridge()\nframe = None\n\n# ros2 node class\nclass CamSubscriber(Node):\n \n    def __init__(self, topic):\n\n        super().__init__('cam_subscriber')\n        self.subscription = self.create_subscription(\n            Image, topic, self.callback, 10)\n\n        self.subscription  # prevent unused variable warning\n\n\n    def callback(self, msg):\n\n        global frame\n        frame = np.asarray(bridge.imgmsg_to_cv2(msg, \"bgr8\"), dtype=np.uint8)\n\n\n\ndef main(inputs, outputs, parameters, synchronise):\n    global frame\n\n    auto_enable = False\n    try:\n        enable = inputs.read_number('Enable')\n    except Exception:\n        auto_enable = True\n\n    rclpy.init()\n    camera_subscriber = CamSubscriber(parameters.read_string(\"ROSTopic\"))\n\n    try:\n        while auto_enable or inputs.read_number('Enable'):\n            frame =  None\n            rclpy.spin_once(camera_subscriber)\n\n            if frame is not None:\n                outputs.share_image(\"Out\", frame)\n\n            synchronise()\n    except Exception as e:\n        print('Error:', e)\n        pass\n    finally:\n        print(\"Exiting\")\n        synchronise()     \n        camera_subscriber.destroy_node()\n        rclpy.shutdown()\n","frequency":"30","params":[{"name":"ROSTopic"}],"ports":{"in":[{"name":"Enable"}],"out":[{"name":"Out"}]},"size":{"width":"300px","height":"300px"}},"position":{"x":425,"y":181}}],"wires":[{"source":{"block":"0004-a6e56f95-1dc2-4c97-835a-f4d7c0980e50","port":"constant-out","name":"ROSTopic"},"target":{"block":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","port":"ROSTopic","name":"ROSTopic"}},{"source":{"block":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","port":"Out","name":"Out"},"target":{"block":"886b6861-1deb-47bb-a4ae-1e452d3ad787","port":"output-in","name":"output-in"}},{"source":{"block":"759a92b9-a22a-49df-8fe1-3ca09741e5ed","port":"input-out","name":"Enable"},"target":{"block":"b8cfb50c-7e01-438c-8c8d-dc09a6d004cd","port":"Enable","name":"Enable"}}]}},"dependencies":{}}